<div id="tasks-content" class="container-fluid h-100 px-0">

  <div id="background-content" #horizontalScrollViewPort class="container-fluid h-100 px-0">

    <div id="background-layer" class="container-fluid px-0"
         [style.width.px]="dateCellWidth * totalDateRange.length"
         [style.margin-left.px]="freeSpaceLeft">

      <ng-template ngFor let-date [ngForOf]="totalDateRange">
        <div class="date-container" [style.width.px]="dateCellWidth">
          <div class="date-cell text-center bg-light" [style.width.px]="dateCellWidth">{{date | date}}</div>
          <div class="hours-cell text-center bg-light" *ngFor="let hour of scaleRange"
               [style.width.px]="elmtCellWidth">{{hour | date: 'HH:mm'}}</div>
        </div>
      </ng-template>

      <div class="background-tasks-container" #verticalScrollViewPort>

        <div class="guide-line" *ngIf="guideLineVisible" [style.left.px]="guideLinePositionLeft">
          <div class="guide-line-time-info">
            {{guideLineTimeInfo | date: 'HH:mm'}}
          </div>
        </div>

        <div class="background-tasks-content" [style.margin-top.px]="freeSpaceTop">
          <ng-template ngFor let-projKey [ngForOf]="projectsKeysDatasource">
            <ng-container *ngTemplateOutlet="projectTemplate; context: {item: projects[projKey]}"></ng-container>
          </ng-template>
        </div>
      </div>

    </div>


  </div>

</div>


<!--==================================================================-->

<ng-template #projectTemplate let-item="item">
  <div class="project-cell"
       [ngStyle]="item._detailsStyle"
       [style.left.px]="-freeSpaceLeft"
       cdkDrag
       (cdkDragStarted)="startDrag($event)"
       (cdkDragMoved)="dragMoved($event, item)"
       (cdkDragEnded)="itemDragged($event, item)"
       cdkDragLockAxis="x">{{item.name}}</div>

  <ng-template [ngIf]="item._hasTasks && !item.collapsed">
    <ng-template ngFor let-taskKey [ngForOf]="item._tasksKeys">
      <ng-container *ngTemplateOutlet="taskTemplate; context: {task: item.tasks[taskKey]}"></ng-container>
    </ng-template>
  </ng-template>

  <ng-template [ngIf]="item._hasChildren && !item.collapsed">
    <ng-template ngFor let-projKey [ngForOf]="item._projectChildrenKeys">
      <ng-container *ngTemplateOutlet="projectTemplate; context: {item: item.projectChildren[projKey]}"></ng-container>
    </ng-template>
  </ng-template>
</ng-template>

<ng-template #taskTemplate let-task="task">
  <div class="project-cell"
       [ngStyle]="task._detailsStyle"
       [style.left.px]="-freeSpaceLeft"
       cdkDrag
       (cdkDragStarted)="startDrag($event)"
       (cdkDragMoved)="dragMoved($event, task)"
       (cdkDragEnded)="itemDragged($event, task)"
       cdkDragLockAxis="x">{{task.name}}</div>
</ng-template>

